(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c82af"],{5471:function(s,a,t){"use strict";t.r(a);var r=function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("hv-snippet",{attrs:{title:""}},[t("template",{slot:"title"},[t("p",[s._v("Node.js 多进程")])]),t("p",[s._v("dataaccess/dbUtil.js")]),t("div",{staticClass:"hv-snippet--tag hv-snippet--tag-javascript"},[s._v("javascript")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" mssql = "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("require")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"mssql"')]),s._v(");\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" log4js = "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("require")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"log4js"')]),s._v(");\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" logger = log4js.getLogger("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dbUtil"')]),s._v(");\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" connConfig = {\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"user"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sa"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"password"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"huang7000@"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"server"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"127.0.0.1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"database"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"testdb"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"connectionTimeout"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("120000")]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"requestTimeout"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3000000")]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retryTimes"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"options"')]),s._v(": {\n       "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"encrypt"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v("\n   },\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"pool"')]),s._v(": {\n       "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"max"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1024")]),s._v(",\n       "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"min"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(",\n       "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"idleTimeoutMillis"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("30000")]),s._v("\n   }\n};\nmssql.on("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'error'")]),s._v(", err => {\n   "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// ... error handler")]),s._v("\n   logger.error(err);\n});\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" connectionPool;\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" getConnection = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//连接数据库")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!(connectionPool && connectionPool.connected)) {\n       connectionPool = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.connect(connConfig);\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" connectionPool;\n}\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//执行query")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" query = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("sql, params")]),s._v(") ")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//写sql语句自由查询")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" pool = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" getConnection();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" request = pool.request();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (params) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//这种不严谨、")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" params) {\n           request.input(index, params[index]);\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" request.query(sql);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 查询列表集合")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" queryList = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("sql, params")]),s._v(") ")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//写sql语句自由查询")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" query(sql, params);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 查询列表集合")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" queryModel = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("tableName, whereObj")]),s._v(") ")]),s._v("{\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" connection = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" getConnection();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" request = connection.request();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`SELECT * FROM "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${tableName}")]),s._v(" WHERE 1=1 `")]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v(" whereObj === "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"object"')]),s._v(" && whereObj !== {}) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" whereObj) {\n           request.input(index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Where'")]),s._v(", whereObj[index]);\n           sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("` AND "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${index}")]),s._v(" = @"),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${index}")]),s._v("Where`")]),s._v("\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" request.query(sql);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".isArray(result.recordset) && result.recordset.length > "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result.recordset["),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("]\n   } "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(";\n   }\n};\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//添加数据判断是否存在")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" insertModel = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("addObj, tableName, whereObj")]),s._v(") ")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//添加数据")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!addObj) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(";\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" connection = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" getConnection();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" request = connection.request();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`BEGIN\n   IF NOT EXISTS (SELECT 1 FROM "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${tableName}")]),s._v(" WHERE 1 > 0`")]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v(" whereObj === "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"object"')]),s._v(" && whereObj !== {}) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" whereObj) {\n           request.input(index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Where'")]),s._v(", whereObj[index]);\n           sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("` AND "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${index}")]),s._v(" = @"),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${index}")]),s._v("Where`")]),s._v("\n       }\n   } "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n       sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("` AND 1>2`")]),s._v("\n   }\n   sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("')'")]),s._v(";\n   sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'BEGIN '")]),s._v(";\n   sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"INSERT INTO "')]),s._v(" + tableName + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"("')]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" addObj) {\n\n       sql += index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(";\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")) {\n       sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('")"')]),s._v(";\n   }\n   sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" values("')]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" addObj) {\n       sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"@"')]),s._v(" + index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(";\n       request.input(index, addObj[index]);\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")) {\n       sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('")"')]),s._v(";\n   }\n   sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`   END\n   END`")]),s._v(";\n\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" request.query(sql);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//更新数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" updateModel = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("updateObj, tableName, whereObj")]),s._v(") ")]),s._v("{\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" connection = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" getConnection();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" request = connection.request();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`UPDATE "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${tableName}")]),s._v(" SET `")]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (updateObj) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" updateObj) {\n           request.input(index, updateObj[index]);\n           sql += index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"=@"')]),s._v(" + index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(";\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")) {\n       sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n   }\n   sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" WHERE 1=1 "')]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (whereObj) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" whereObj) {\n           request.input(index, whereObj[index]);\n           sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" AND "')]),s._v(" + index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"=@"')]),s._v(" + index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" AND "')]),s._v(")) {\n       sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" request.query(sql);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 查询列表集合")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" deleteModel = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("tableName, whereObj")]),s._v(") ")]),s._v("{\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" connection = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" getConnection();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" request = connection.request();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`DELETE  FROM "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${tableName}")]),s._v("`")]),s._v(";\n   sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" WHERE 1=1 "')]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (whereObj) {\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" whereObj) {\n           request.input(index, whereObj[index]);\n           sql += "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" AND "')]),s._v(" + index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"=@"')]),s._v(" + index + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" AND "')]),s._v(")) {\n       sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" request.query(sql);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\n\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//批量合并数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" mergeObjs = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("targetTable, objs, whereStr, uFields, iFields, isDelete")]),s._v(") ")]),s._v("{\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" rowIndex = "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n   sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n   ( `")]),s._v("\n   objs.forEach("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("mergeObj")]),s._v(" =>")]),s._v(" {\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n       SELECT  * FROM (SELECT `")]),s._v(";\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" mergeObj) {\n           sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("` '"),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${mergeObj[index]}")]),s._v("' AS  "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${index}")]),s._v(",`")]),s._v(";\n       }\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")) {\n           sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('") AS t_"')]),s._v(" + rowIndex + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n           UNION ALL `")]),s._v(";\n       }\n       rowIndex++;\n   });\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" UNION ALL "')]),s._v(")) {\n       sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("` "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" UNION ALL "')]),s._v(".length)}")]),s._v(" \n   ) AS sourceTable `")]),s._v(";\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = merge(targetTable, sql, whereStr, uFields, iFields, isDelete);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//批量合并数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" merge = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("targetTable, sourceTable, whereStr, uFields, iFields, isDelete")]),s._v(") ")]),s._v("{\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" connection = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" getConnection();\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" request = connection.request();\n   "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//mergeObjs先插入临时表， 在")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" sql = "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n   sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n   MERGE INTO "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${targetTable}")]),s._v("  AS T\n   USING  (SELECT  * FROM "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${sourceTable}")]),s._v("  ) AS S \n   ON 2>1 "),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v(" whereStr==="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'string'")]),s._v("&&whereStr!=="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(")?whereStr:"),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v("}")]),s._v("`")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//U匹对修改")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".isArray(uFields) && uFields !== []) {\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n       WHEN MATCHED THEN`")]),s._v("\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n       UPDATE SET `")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" field "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("of")]),s._v(" uFields) {\n           sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`T."),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${field}")]),s._v("=S."),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${field}")]),s._v(" ,`")]),s._v(";\n       }\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")) {\n           sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('""')]),s._v(";\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//I匹对新增")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".isArray(iFields) && iFields !== []) {\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n       WHEN NOT MATCHED  BY TARGET THEN `")]),s._v(";\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n       INSERT("),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${ iFields.join("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")  }")]),s._v(")`")]),s._v(";\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`VALUES(`")]),s._v(";\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" field "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("of")]),s._v(" iFields) {\n           sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`S."),t("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${field}")]),s._v(" ,`")]),s._v(";\n       }\n       "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (sql.endsWith("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('","')]),s._v(")) {\n           sql = sql.substring("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", sql.length - "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('")"')]),s._v(";\n       }\n   }\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (isDelete) {\n       sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`\n       WHEN NOT MATCHED BY SOURCE THEN\n       Delete`")]),s._v(";\n   }\n   sql = sql + "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`;`")]),s._v(";\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" request.query(sql);\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" mssql.close(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// close")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n};\nexports.query = query;\nexports.queryList = queryList;\nexports.queryModel = queryModel;\nexports.deleteModel = deleteModel;\nexports.updateModel = updateModel;\nexports.insertModel = insertModel;\nexports.mergeObjs = mergeObjs;\nexports.merge = merge;\n")])]),t("p",[s._v("index.js")]),t("div",{staticClass:"hv-snippet--tag hv-snippet--tag-javascript"},[s._v("javascript")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" log4js = "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("require")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'log4js'")]),s._v(");\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" dbUtil = "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("require")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'./dataaccess/dbUtil'")]),s._v(");\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// config log4js")]),s._v("\nlog4js.configure({\n "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("appenders")]),s._v(": {\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("everything")]),s._v(": {\n     "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'file'")]),s._v(",\n     "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("filename")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'./logs/sys.log'")]),s._v(",\n     "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("maxLogSize")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2048000")]),s._v("\n   }\n },\n "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("categories")]),s._v(": {\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("default")]),s._v(": {\n     "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("appenders")]),s._v(": ["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'everything'")]),s._v("],\n     "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("level")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'info'")]),s._v("\n   }\n }\n});\n\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" (")]),s._v(") =>")]),s._v(" {\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//增")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// let insertresult = await dbUtil.insertModel({")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   id: '11',")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   name: 'test2',")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   age: 28")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// }, 't_targetTable');")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// let results_1 = await dbUtil.query(`SELECT * FROM t_targetTable`);")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//改 updateObj, whereObj, tableNam")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// let updatesult = await dbUtil.updateModel({")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   id: '11',")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   name: 'test2test2',")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   age: 2828")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// }, 't_targetTable', {")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   id: '11',")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// });")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// let results_2 = await dbUtil.query(`SELECT * FROM t_targetTable`);")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// //删")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// let deleteresult = await dbUtil.deleteModel('t_targetTable', {")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//   id: '11',")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// });")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// let results_3 = await dbUtil.query(`SELECT * FROM t_targetTable`)")]),s._v("\n\n "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 查")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" queryresult = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" dbUtil.queryModel("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'t_targetTable'")]),s._v(", {\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'1'")]),s._v(",\n });\n "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" objs = [{\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"小明"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("age")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("18")]),s._v("\n }, {\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"小红 "')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("age")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("17")]),s._v("\n }, {\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"小强"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("age")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20")]),s._v("\n }];\n "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" mergeresult = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" dbUtil.mergeObjs("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"t_targetTable"')]),s._v(", objs, "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" AND T.id=S.id"')]),s._v(", ["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"id"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"name"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"age"')]),s._v("], ["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"id"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"name"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"age"')]),s._v("\n ], "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(");\n "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" results_4 = "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" dbUtil.query("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`SELECT * FROM t_targetTable`")]),s._v(")\n})();\n")])])],2)],1)},e=[],l=t("2877"),n={},p=Object(l["a"])(n,r,e,!1,null,null,null);a["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d0c82af.5bd78517.js.map